<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>&#x2694LRM&#x2694</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .cards-container {
            display: flex;
            gap: 10px;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 30px;
            flex-wrap: nowrap;
            text-align: center;
            justify-content: center;
        }
        .card {
            width: 100px;
            height: 140px;
            border-radius: 3px;
            box-shadow: 0 4px 6px rgba(255,255,255,0.3);
            transition: all 0.3s ease;
            overflow: hidden;
            opacity: 0;
            transform: translateY(20px);
        }
        .card.dealt {
            opacity: 1;
            transform: translateY(0);
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .practice-section {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .street-input {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            opacity: 0.5;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .street-input.active {
            opacity: 1;
            pointer-events: all;
        }
        .validation-icon {
            font-size: 24px;
            height: 30px;
            visibility: hidden;
        }
        .validation-icon.correct {
            visibility: visible;
            color: #4CAF50;
        }
        .validation-icon.incorrect {
            visibility: visible;
            color: #f44336;
        }
    </style>
</head>

<body>
    <script type=module src=../main.js></script>
    <div class="wrapper-main">
        <my-header></my-header>
        <main>
            <h1>
                <br>Hold'em Board Generator
            </h1>
            <div class="cards-container" id="cardsContainer"></div>
            <div>
                <button onclick="dealNext()" id="dealButton">Deal Flop</button>
            </div>
            
            <datalist id="hand-types">
                <option value="Straight Flush"></option>
                <option value="Quads"></option>
                <option value="Full House"></option>
                <option value="Flush"></option>
                <option value="Straight"></option>
                <option value="Trips"></option>
                <option value="Two Pair"></option>
                <option value="Pair"></option>
                <option value="High Card"></option>
            </datalist>

            <div class="practice-section">
                <!-- Flop Input -->
                <div class="street-input" id="flopSection">
                    <label for="nutsFlop">Flop Nuts:</label>
                    <input list="hand-types" id="nutsFlop" onchange="checkAnswer('flop')" placeholder="Select..." />
                    <div class="validation-icon" id="iconFlop"></div>
                    <!-- Hidden field to store correct answer -->
                    <input type="hidden" id="answerFlop">
                </div>

                <!-- Turn Input -->
                <div class="street-input" id="turnSection">
                    <label for="nutsTurn">Turn Nuts:</label>
                    <input list="hand-types" id="nutsTurn" onchange="checkAnswer('turn')" placeholder="Select..." />
                    <div class="validation-icon" id="iconTurn"></div>
                    <input type="hidden" id="answerTurn">
                </div>

                <!-- River Input -->
                <div class="street-input" id="riverSection">
                    <label for="nutsRiver">River Nuts:</label>
                    <input list="hand-types" id="nutsRiver" onchange="checkAnswer('river')" placeholder="Select..." />
                    <div class="validation-icon" id="iconRiver"></div>
                    <input type="hidden" id="answerRiver">
                </div>
            </div>

    <script>
        let currentDeck = [];
        let currentHand = [];
        let dealStage = 0; // 0 = ready for flop, 1 = flop dealt, 2 = turn dealt, 3 = river dealt
        
        const suits = ['hearts', 'diamonds', 'clubs', 'spades'];
        const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '0', 'J', 'Q', 'K'];
        
        function createDeck() {
            const deck = [];
            for (let suit of suits) {
                for (let rank of ranks) {
                    deck.push({
                        rank: rank,
                        suit: suit,
                        image: `https://deckofcardsapi.com/static/img/${rank.toUpperCase()}${suit.charAt(0).toUpperCase()}.png`
                    });
                }
            }
            return deck;
        }
        
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        function resetInputs() {
            ['Flop', 'Turn', 'River'].forEach(street => {
                const input = document.getElementById(`nuts${street}`);
                const icon = document.getElementById(`icon${street}`);
                const section = document.getElementById(`${street.toLowerCase()}Section`);
                const answer = document.getElementById(`answer${street}`);

                input.value = '';
                input.disabled = false;
                icon.className = 'validation-icon';
                icon.textContent = '';
                section.classList.remove('active');
                answer.value = '';
            });
        }

        function activateSection(street, correctCuts) {
            const section = document.getElementById(`${street.toLowerCase()}Section`);
            const answer = document.getElementById(`answer${street}`);
            section.classList.add('active');
            answer.value = correctCuts;
        }

        function checkAnswer(street) {
            const streetCap = street.charAt(0).toUpperCase() + street.slice(1);
            const input = document.getElementById(`nuts${streetCap}`);
            const answer = document.getElementById(`answer${streetCap}`);
            const icon = document.getElementById(`icon${streetCap}`);
            
            if (!input.value) return;

            if (input.value === answer.value) {
                icon.textContent = '✅';
                icon.className = 'validation-icon correct';
            } else {
                icon.textContent = '❌';
                icon.className = 'validation-icon incorrect';
            }
        }

        function dealNext() {
            const button = document.getElementById('dealButton');
            const container = document.getElementById('cardsContainer');
            
            if (dealStage === 0) {
                // Deal flop (3 cards)
                resetInputs(); // Clear previous game
                const deck = createDeck();
                const shuffled = shuffleArray(deck);
                currentHand = shuffled.slice(0, 5);
                
                container.innerHTML = '';
                
                // Create all card elements
                currentHand.forEach(card => {
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'card';
                    cardDiv.innerHTML = `<img src="${card.image}" alt="${card.rank} of ${card.suit}">`;
                    container.appendChild(cardDiv);
                });
                
                const cards = container.querySelectorAll('.card');
                
                // Deal first 3 cards
                setTimeout(() => cards[0].classList.add('dealt'), 100);
                setTimeout(() => cards[1].classList.add('dealt'), 200);
                setTimeout(() => cards[2].classList.add('dealt'), 300);
                
                dealStage = 1;
                button.textContent = 'Deal Turn';
                
                const nuts = identifyNuts(currentHand.slice(0, 3));
                activateSection('Flop', nuts);
                
            } else if (dealStage === 1) {
                // Deal turn (4th card)
                const cards = container.querySelectorAll('.card');
                cards[3].classList.add('dealt');
                dealStage = 2;
                button.textContent = 'Deal River';
                
                const nuts = identifyNuts(currentHand.slice(0, 4));
                activateSection('Turn', nuts);
                
            } else if (dealStage === 2) {
                // Deal river (5th card)
                const cards = container.querySelectorAll('.card');
                cards[4].classList.add('dealt');
                dealStage = 3;
                button.textContent = 'New Hand';
                
                const nuts = identifyNuts(currentHand.slice(0, 5));
                activateSection('River', nuts);
                
            } else {
                // Reset for new hand
                dealStage = 0;
                button.textContent = 'Deal Flop';
                dealNext();
            }
        }
        
        // Start with button ready
        dealStage = 0;

        function getCardRank(rankStr) {
            const map = {
                'A': 14,
                'K': 13,
                'Q': 12,
                'J': 11,
                '0': 10
            };
            return map[rankStr] || parseInt(rankStr);
        }

        // Checks if 3+ unique ranks fit within a window of 5 (e.g. max-min <= 4)
        function checkStraightPotential(ranks) {
            // Handle unique ranks only
            const unique = [...new Set(ranks)].sort((a, b) => a - b);
            
            // Handle Wheel case: if A (14) is present, add 1
            if (unique.includes(14)) {
                unique.unshift(1);
            }

            // Iterate through every combination of 3 cards
            
            for (let i = 0; i < unique.length; i++) {
                for (let j = i + 1; j < unique.length; j++) {
                    for (let k = j + 1; k < unique.length; k++) {
                        const sub = [unique[i], unique[j], unique[k]];
                        const max = Math.max(...sub);
                        const min = Math.min(...sub);
                        if (max - min <= 4) return true;
                    }
                }
            }
            return false;
        }

        function identifyNuts(board) {
            // 1. Parse board
            const suitsCount = {};
            const ranks = [];
            const cardsBySuit = {};

            board.forEach(c => {
                const r = getCardRank(c.rank);
                ranks.push(r);
                
                suitsCount[c.suit] = (suitsCount[c.suit] || 0) + 1;
                
                if (!cardsBySuit[c.suit]) cardsBySuit[c.suit] = [];
                cardsBySuit[c.suit].push(r);
            });

            // 2. Check Straight Flush
            // If any suit has >= 3 cards, check if those cards have straight potential
            for (const suit in cardsBySuit) {
                if (cardsBySuit[suit].length >= 3) {
                    if (checkStraightPotential(cardsBySuit[suit])) {
                        return "Straight Flush";
                    }
                }
            }

            // 3. Check Quads (Pair on board)
            const rankCounts = {};
            let hasPair = false;
            ranks.forEach(r => {
                rankCounts[r] = (rankCounts[r] || 0) + 1;
                if (rankCounts[r] >= 2) hasPair = true;
            });

            if (hasPair) {
                return "Quads";
            }

            // 4. Check Flush
            // If any suit has >= 3 cards (and SF check failed)
            const maxSuitCount = Math.max(...Object.values(suitsCount));
            if (maxSuitCount >= 3) {
                return "Flush";
            }

            // 5. Check Straight
            if (checkStraightPotential(ranks)) {
                return "Straight";
            }

            // 6. Default to Trips
            return "Trips";
        }
    </script>
  
        </main>
        <my-footer></my-footer>
    </div>
</body>
</html>